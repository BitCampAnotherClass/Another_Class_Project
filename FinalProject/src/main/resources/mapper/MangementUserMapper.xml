<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.anotherclass.bitcamp.dao.admin.UserMangementDAO">
	<select id="managementListCount" resultType="int" parameterType="com.anotherclass.bitcamp.vo.admin.UserManagementPagingDTO" >
		SELECT count(member_id)
        FROM(SELECT ROW_NUMBER() OVER(ORDER BY signupdate desc)num2, a.* from(select member_id, 
        member_name,member_email, member_tel, signupdate FROM(SELECT ROW_NUMBER() OVER(ORDER BY m.signupdate desc)num, m.member_id, m.member_name, 
		m.member_email, m.member_tel,m.signupdate from membertbl m INNER JOIN IDALL id
		on (m.member_id = id.member_id and id.type_user = 1))
		<if test="searchStartDate != null">
			<![CDATA[ where (signupdate >= to_date(#{searchStartDate},'YY-MM-DD') and signupdate <= to_date(#{searchEndDate},'YY-MM-DD'))]]>
		</if>
		<if test="searchWord != null">
			<![CDATA[ AND (member_name LIKE '%'||#{searchWord}||'%' or member_name LIKE '%'||#{searchWord} or member_name LIKE #{searchWord}||'%')]]>
		</if>
		<![CDATA[)a)]]>
	</select>
	<select id="memberList" parameterType="com.anotherclass.bitcamp.vo.admin.UserManagementPagingDTO" resultType="com.anotherclass.bitcamp.vo.admin.UserMangementDTO" >
		SELECT num2,member_id, member_name,member_email, member_tel, to_char(signupdate,'YYYY-MM-DD')signupdate 
        FROM(SELECT ROW_NUMBER() OVER(ORDER BY signupdate desc)num2, a.* from(select member_id, 
        member_name,member_email, member_tel, signupdate FROM(SELECT ROW_NUMBER() OVER(ORDER BY m.signupdate desc)num, m.member_id, m.member_name, 
		m.member_email, m.member_tel,m.signupdate from membertbl m INNER JOIN IDALL id
		on (m.member_id = id.member_id and id.type_user = 1))
		<if test="searchStartDate != null">
			<![CDATA[ where (signupdate >= to_date(#{searchStartDate},'YY-MM-DD') and signupdate <= to_date(#{searchEndDate},'YY-MM-DD'))]]>
		</if>
		<if test="searchWord != null">
			<![CDATA[ AND (member_name LIKE '%'||#{searchWord}||'%' or member_name LIKE '%'||#{searchWord} or member_name LIKE #{searchWord}||'%')]]>
		</if>
		<![CDATA[)a) where num2 >=#{startNumber} and num2 <=#{endNumber}]]>
	</select>
	<select id="memberInformation" resultType="com.anotherclass.bitcamp.vo.admin.UserMangementDTO" parameterType="String" >
	<![CDATA[
		SELECT a.member_id, a.member_name, a.member_email, a.member_tel, a.sns_type, a.signupdate, a.addr1, a.addr2 from memberTbl a, usertbl u where u.member_id = #{param1}
		and a.member_id  = #{param1}
	 ]]>	
	</select>
</mapper>